# Веб-приложение для моделирования роботов-манипуляторов

Веб-приложение для расчёта и визуализации траекторий промышленных роботов-манипуляторов. Проект представляет собой современную веб-версию десктопного приложения, разработанного на PyQt5.

[![Python](https://img.shields.io/badge/Python-3.10+-blue.svg)](https://www.python.org/)
[![FastAPI](https://img.shields.io/badge/FastAPI-0.115-green.svg)](https://fastapi.tiangolo.com/)
[![React](https://img.shields.io/badge/React-18-blue.svg)](https://react.dev/)
[![Vite](https://img.shields.io/badge/Vite-5-purple.svg)](https://vitejs.dev/)
[![License](https://img.shields.io/badge/License-MIT-yellow.svg)](LICENSE)

**Репозиторий:** [https://github.com/Alex171228/Autumn-tears-2.0](https://github.com/Alex171228/Autumn-tears-2.0)

> ✅ Протестировано на Windows 11

## Описание

Приложение позволяет моделировать работу промышленных роботов-манипуляторов четырёх типов:
- **Декартовый робот** — перемещение по трём взаимно перпендикулярным осям X, Y, Z
- **Цилиндрический робот** — использует цилиндрическую систему координат
- **SCARA робот** — горизонтально-шарнирный робот для сборочных операций
- **Колер** — аналогичен цилиндрическому роботу, специализированная кинематика

### Основные возможности

- **Расчёт траекторий** — позиционное и контурное управление
- **Визуализация графиков** — траектории, скорости, ускорения, токи, напряжения, моменты
- **Настройка параметров** — ПИД-регулятор, двигатели, конструктивные параметры
- **Сохранение конфигураций** — локально в файл или в облаке (для авторизованных пользователей)
- **Система авторизации** — регистрация, вход, смена пароля
- **Админ-панель** — управление пользователями и конфигурациями
- **Виджет погоды** — отображение текущей погоды
- **Сплайн-интерполяция** — сглаживание траекторий кубическими сплайнами

## Технологии

### Backend
- **FastAPI** — современный асинхронный веб-фреймворк
- **SQLAlchemy** — ORM для работы с базой данных
- **SQLite** — встроенная база данных
- **NumPy / SciPy** — математические расчёты и интерполяция
- **Matplotlib** — генерация графиков
- **bcrypt** — безопасное хеширование паролей
- **python-jose** — JWT токены для авторизации
- **slowapi** — защита от брутфорса (rate limiting)

### Frontend
- **React 18** — библиотека для построения UI
- **Vite** — быстрый сборщик и dev-сервер
- **CSS3** — стилизация с градиентами и анимациями

## Структура проекта

```
webapp_full_ui/
├── main.py                  # Основной файл FastAPI приложения
├── database.py              # Модели базы данных (User, SavedConfig)
├── models.py                # Pydantic модели для API
├── trajectory_calculator.py # Логика расчёта траекторий
├── requirements.txt         # Python зависимости
├── package.json             # Node.js зависимости
├── vite.config.js           # Конфигурация Vite
├── index.html               # Точка входа HTML
├── Dockerfile               # Конфигурация Docker
├── README.md                # Документация проекта
├── users.db                 # База данных SQLite (создаётся автоматически)
│
├── start-all.bat            # Скрипт запуска обоих серверов (Windows)
├── start-backend.bat        # Скрипт запуска backend (Windows)
├── start-frontend.bat       # Скрипт запуска frontend (Windows)
│
├── src/
│   ├── index.jsx            # Точка входа React
│   ├── index.css            # Глобальные стили
│   ├── App.jsx              # Главный компонент приложения
│   │
│   ├── components/
│   │   ├── TopMenu.jsx          # Верхнее меню
│   │   ├── DateTimeWidget.jsx   # Виджет даты и времени
│   │   ├── WeatherWidget.jsx    # Виджет погоды
│   │   ├── Tabs.jsx             # Вкладки (Траектория, Рабочая область, Лог)
│   │   ├── StatusBar.jsx        # Строка состояния
│   │   └── dialogs/             # Диалоговые окна (25 компонентов)
│   │
│   ├── hooks/
│   │   └── useDraggableDialog.js  # Хук для перетаскивания окон
│   │
│   └── services/
│       ├── robotApi.js          # API для расчётов робота
│       ├── configsApi.js        # API для облачных конфигураций
│       └── adminApi.js          # API для админ-панели
│
├── static/
│   └── ohota.jpg            # Изображение
│
└── public/                  # Статические файлы Vite
```

## Установка и запуск

### Требования
- Python 3.10 или выше
- Node.js 18 или выше
- npm или yarn

> **Примечание:** Проект использует Pydantic v2. Код обновлён и совместим с последними версиями зависимостей.

### 1. Клонирование репозитория

```bash
git clone https://github.com/Alex171228/Autumn-tears-2.0.git
cd Autumn-tears-2.0
```

### 2. Создание виртуального окружения Python (рекомендуется)

**Windows (PowerShell):**
```powershell
python -m venv venv
.\venv\Scripts\activate
```

**Linux/Mac:**
```bash
python3 -m venv venv
source venv/bin/activate
```

### 3. Установка Python зависимостей

```bash
pip install -r requirements.txt
```

### 4. Установка Node.js зависимостей

```bash
npm install
```

### 4.1. Настройка переменных окружения (опционально)

Для работы виджета погоды создайте файл `.env` в корне проекта:

```env
OPENWEATHER_API_KEY=your_api_key_here
WEATHER_CITY=Moscow
SECRET_KEY=your-secret-key-change-in-production
```

> **Примечание:** Виджет погоды будет работать только при наличии `OPENWEATHER_API_KEY`. Остальные функции приложения работают без этого файла.

### 5. Запуск приложения

#### Вариант А: Быстрый запуск (Windows)

Двойной клик по файлу `start-all.bat` — запустит оба сервера в отдельных окнах.

Или запустите по отдельности:
- `start-backend.bat` — только backend
- `start-frontend.bat` — только frontend

#### Вариант Б: Ручной запуск

**Терминал 1 — Backend (FastAPI):**

**Windows (PowerShell):**
```powershell
.\venv\Scripts\activate
uvicorn main:app --reload --host 127.0.0.1 --port 8000
```

**Linux/Mac:**
```bash
source venv/bin/activate
uvicorn main:app --reload --host 127.0.0.1 --port 8000
```

Backend будет доступен по адресу: http://127.0.0.1:8000

**Терминал 2 — Frontend (Vite):**

```bash
npm run dev
```

Frontend будет доступен по адресу: http://127.0.0.1:5173/

### 6. Открытие приложения

Откройте в браузере: **http://127.0.0.1:5173/**

### Остановка серверов

Нажмите `Ctrl+C` в каждом окне терминала или закройте окна.

## Использование

### Быстрый старт

1. Откройте http://127.0.0.1:5173/ в браузере
2. Выберите тип робота: **Режим → Тип робота**
3. Настройте параметры в меню **Параметры**:
   - Движение → Позиционное/Контурное
   - Регулятор (коэффициенты ПИД)
   - Двигатель (параметры электродвигателей)
   - Конструктивные параметры робота
4. Задайте циклограмму движения: **Параметры → Движение → Позиционное → Циклограмма**
5. Нажмите **Расчет → Рассчитать траекторию**
6. Просмотрите результаты на вкладках:
   - **Траектория** — графики различных параметров
   - **Рабочая область** — визуализация рабочего пространства робота
   - **Лог** — журнал операций

### Работа с файлами

- **Данные → Файл → Загрузить из файла** — загрузка конфигурации из .txt файла
- **Данные → Файл → Скачать в файл** — сохранение конфигурации в файл

### Облачное хранение (требуется авторизация)

1. Зарегистрируйтесь: **Авторизация → Регистрация**
2. Войдите в аккаунт: **Авторизация → Войти**
3. Сохраните конфигурацию: **Данные → Облако → Сохранить**
4. Загрузите сохранённую: **Данные → Облако → Мои конфигурации**

### Администрирование

По умолчанию создаётся администратор:
- **Логин:** admin
- **Пароль:** admin123

**Важно:** Смените пароль администратора после первого входа!

Функции админ-панели (**Админ → Управление пользователями**):
- Просмотр списка пользователей
- Назначение/снятие прав администратора
- Удаление пользователей
- Просмотр и загрузка любых конфигураций
- Удаление конфигураций

## Типы графиков

| Категория      | Графики                                     |
|----------------|---------------------------------------------|
| **Траектория** | Обобщённые координаты, Декартовы координаты |
| **Скорость**   | Скорость звена 1, Скорость звена 2          |
| **Ускорение**  | Ускорение звена 1, Ускорение звена 2        |
| **Электрика**  | Напряжение, Ток                             |
| **Моменты**    | Момент двигателя, Момент нагрузки           |
| **Ошибки**     | Ошибка регулирования                        |

## Безопасность

- Пароли хешируются с использованием bcrypt
- Авторизация через JWT токены
- Защита от SQL-инъекций (SQLAlchemy ORM)
- Rate limiting для защиты от брутфорса
- Привязка админ-сессии к IP-адресу
- Автоматический выход администратора при неактивности

## API Endpoints

### Авторизация
- `POST /api/register` — регистрация
- `POST /api/login` — вход
- `GET /api/me` — информация о текущем пользователе
- `POST /api/change-password` — смена пароля

### Робот
- `POST /api/robot/configure` — настройка параметров
- `POST /api/robot/calculate` — расчёт траектории
- `GET /api/robot/plot/{type}` — получение графика
- `GET /api/robot/workspace` — рабочая область
- `GET /api/robot/spline-cyclegram` — данные сплайна

### Конфигурации
- `GET /api/configs` — список конфигураций пользователя
- `POST /api/configs` — создание конфигурации
- `PUT /api/configs/{id}` — обновление
- `DELETE /api/configs/{id}` — удаление

### Файлы
- `POST /api/data/upload` — загрузка файла
- `POST /api/data/download` — скачивание файла

### Админ
- `GET /api/admin/users` — список пользователей
- `GET /api/admin/configs` — все конфигурации
- `DELETE /api/admin/users/{id}` — удаление пользователя
- `PUT /api/admin/users/{id}/toggle-admin` — переключение прав админа

## Формат файла конфигурации

Файлы конфигурации (.txt) совместимы с десктопной версией приложения:

```
Тип робота
Коэффициенты ПИД (Kp, Ki, Kd для 4 звеньев)
Циклограмма (t, q1, q2, q3, q4 — по 9 точек)
Параметры двигателей
Конструктивные параметры
Ограничения рабочей области
```

## Вклад в проект

1. Форкните репозиторий: https://github.com/Alex171228/Autumn-tears-2.0
2. Создайте ветку для новой функции (`git checkout -b feature/amazing-feature`)
3. Закоммитьте изменения (`git commit -m 'Add amazing feature'`)
4. Отправьте в ветку (`git push origin feature/amazing-feature`)
5. Откройте Pull Request

## Лицензия

Этот проект распространяется под лицензией MIT. См. файл [LICENSE](LICENSE) для подробностей.
