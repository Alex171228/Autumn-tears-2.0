<!doctype html>
<html lang="ru">
<meta charset="utf-8" />
<title>PyQt → Web интерфейс</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<style>
  html, body {
    margin: 0;
    padding: 0;
    height: 100%;
  }
  body {
    font-family: Arial, system-ui, sans-serif;
    background-color: #6bdba0; /* зелёный фон как в PyQt */
  }

  /* ===== Верхнее меню с выпадающими пунктами (QMenuBar/QMenu) ===== */
  #menuBar {
    background-color: #287571;
    border-bottom: 2px solid blue;
    display: flex;
    align-items: stretch;
    padding: 0;
    height: 26px;
    box-sizing: border-box;
  }

  .menu-root {
    position: relative;
    display: flex;
    align-items: stretch;
  }

  .menu-button,
  .menu-label {
    background-color: #3ab0aa;
    color: black;
    border: 1px solid blue;
    border-top: none;
    border-bottom: none;
    padding: 2px 10px;
    font-size: 14px;
    cursor: pointer;
    display: flex;
    align-items: center;
    white-space: nowrap;
  }

  .menu-button:first-child,
  .menu-label:first-child {
    border-left-width: 0;
  }

  .menu-button:hover,
  .menu-label:hover {
    background-color: #87CEFA;
  }

  .menu-spacer {
    flex: 1;
  }

  .menu-item {
    position: relative;
  }

  .menu-item > .menu-label::after {
    content: " ▾";
    font-size: 11px;
    margin-left: 4px;
  }

  .submenu {
    position: absolute;
    top: 100%;
    left: 0;
    background: #f8f9fa;
    border: 1px solid #1f2937;
    min-width: 200px;
    z-index: 100;
    display: none;
  }

  .submenu button,
  .submenu .submenu-label {
    display: block;
    width: 100%;
    text-align: left;
    padding: 4px 10px;
    border: none;
    background: #f8f9fa;
    font-size: 13px;
    cursor: pointer;
    white-space: nowrap;
  }

  .submenu button:hover,
  .submenu .submenu-label:hover {
    background: #e5e7eb;
  }

  /* вложенное подменю (для Робота, Движения и т.п.) */
  .submenu-item {
    position: relative;
  }
  .submenu-item > .submenu-label::after {
    content: " ▸";
    float: right;
    font-size: 11px;
    margin-left: 4px;
  }
  .submenu-level2 {
    position: absolute;
    top: 0;
    left: 100%;
    background: #f8f9fa;
    border: 1px solid #1f2937;
    min-width: 220px;
    display: none;
    z-index: 110;
  }

  .submenu-item:hover > .submenu-level2 {
    display: block;
  }

  .menu-item:hover > .submenu {
    display: block;
  }

  /* ===== Макет основного окна ===== */
  #mainWrapper {
    display: grid;
    grid-template-rows: 1fr auto;
    height: calc(100% - 26px);
  }
  #centralArea {
    display: grid;
    grid-template-columns: 260px 1fr;
    height: 100%;
  }
  #leftDock {
    position: relative;
    padding: 10px;
    box-sizing: border-box;
  }
  #centerContent {
    padding: 10px;
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
  }

  /* Виджет времени */
  #datetimeWidget {
    position: absolute;
    top: 10px;
    left: 10px;
  }
  #datetimeLabel {
    background-color: #3b84e3;
    border: 3px solid white;
    border-radius: 10px;
    padding: 10px 20px;
    color: black;
    font-size: 24px;
    line-height: 1.2;
    white-space: pre-line;
    text-align: center;
    min-width: 140px;
    box-sizing: border-box;
  }

  /* Виджет погоды */
  #weatherWidget {
    position: absolute;
    top: 140px;
    left: 10px;
    display: flex;
    align-items: flex-start;
    gap: 10px;
  }
  #weatherInfo {
    background-color: #ffffff;
    border: 3px solid blue;
    border-radius: 15px;
    padding: 10px;
    font-size: 14px;
    line-height: 1.3;
    min-width: 170px;
    box-sizing: border-box;
  }
  #weatherIconBox {
    background-color: #ffffff;
    border: 3px solid blue;
    border-radius: 15px;
    width: 80px;
    height: 80px;
    display: flex;
    align-items: center;
    justify-content: center;
    box-sizing: border-box;
  }
  #weatherIconBox img {
    max-width: 60px;
    max-height: 60px;
  }

  /* Центральные вкладки (QTabWidget) */
  #tabs {
    display: flex;
    gap: 6px;
    border-bottom: 1px solid #e5e7eb;
  }
  .tab {
    padding: 6px 10px;
    border: 1px solid #e5e7eb;
    border-bottom: none;
    border-radius: 8px 8px 0 0;
    background: #f8fafc;
    cursor: pointer;
    font-size: 14px;
  }
  .tab[aria-selected="true"] {
    background: #ffffff;
    font-weight: 600;
  }
  #tabContent > section {
    display: none;
    padding: 10px;
  }
  #tabContent > section[data-active="true"] {
    display: block;
  }

  /* Статусбар */
  #statusBar {
    border-top: 1px solid #e5e7eb;
    background: #f3f4f6;
    padding: 4px 10px;
    font-size: 12px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-sizing: border-box;
  }

 /* Диалоги параметров / ограничений */
  .dlg {
    width: 320px;
    background: #f0f0f0;
  }
  .dlg-header {
    font-size: 18px;
    font-weight: 700;
    padding: 8px 12px 4px;
  }
  .dlg-form {
    margin: 0 10px 10px;
    padding: 10px;
    background: #ffffff;
    border: 1px solid #d4d4d4;
  }
  .dlg-form-row {
    display: grid;
    grid-template-columns: 1fr auto;
    align-items: center;
    gap: 6px;
    margin: 4px 0;
    font-size: 13px;
  }
  .dlg-form-row label {
    margin-right: 6px;
  }
  .dlg-form-row input {
    width: 80px;
    padding: 2px 4px;
    font-size: 13px;
  }

  .dlg-footer {
    padding: 0 10px 10px;
  }
  .dlg-footer-row {
    display: flex;
    gap: 4px;
  }
  .dlg-btn {
    flex: 1;
    padding: 6px 0;
    border: none;
    font-size: 14px;
    cursor: pointer;
  }
  .dlg-btn-help {
    background: #87CEEB;
  }
  .dlg-btn-ok {
    background: #18f22e;
  }
  .dlg-btn-cancel {
    background: red;
    color: white;
  }
  /* ===== Только для Параметров двигателей и Параметров регуляторов ===== */
dialog.dlg-wide .dlg {
    width: 650px;      /* увеличенная ширина окна */
    max-width: 650px;
}

/* Увеличенный размер полей */
dialog.dlg-wide .dlg-form table input {
    width: 140px;      /* было ~70px -> стало почти в 2 раза шире */
}

/* Чуть увеличим промежутки */
dialog.dlg-wide .dlg-form table td {
    padding: 8px 12px;
}
/* ===== Только для окна Параметров регуляторов (ещё шире) ===== */
dialog.dlg-wide-big .dlg {
    width: 960px;        /* 650px × 1.5 ≈ 975, округлил до 960 */
    max-width: 960px;
}

/* Увеличим ширину полей и расстояния */
dialog.dlg-wide-big .dlg-form table input {
    width: 140px;        /* поля тоже больше (было 140) */
}

dialog.dlg-wide-big .dlg-form table td {
    padding: 10px 14px;  /* немного больше отступы */
}


</style>

<body>

  <!-- ===== Меню как в PyQt (с именами и иерархией из create_menu_bar) ===== -->
  <div id="menuBar">
    <!-- Бургер-кнопка "≡" -->
    <div class="menu-root">
      <button class="menu-button" data-action="show_creators_info">≡</button>
    </div>

    <!-- Кнопка "Проверить обновления" -->
    <div class="menu-root">
      <button class="menu-button" data-action="check_for_update">Проверить обновления</button>
    </div>

    <!-- Меню "Данные" -->
    <div class="menu-root menu-item">
      <div class="menu-label"> Данные </div>
      <div class="submenu">
        <button data-action="load_data">Загрузить данные</button>
        <button data-action="save_data">Сохранить</button>
        <button data-action="save_data_as">Сохранить как</button>
      </div>
    </div>

    <!-- Меню "Режим работы" -->
    <div class="menu-root menu-item">
      <div class="menu-label"> Режим работы </div>
      <div class="submenu">
        <button data-action="show_robot_type_dialog">Тип робота</button>
        <button data-action="show_movement_type_dialog">Тип движения</button>
      </div>
    </div>

    <!-- Меню "Параметры" -->
    <div class="menu-root menu-item">
      <div class="menu-label"> Параметры </div>
      <div class="submenu">
        <!-- Робот -->
        <div class="submenu-item">
          <div class="submenu-label">Робот</div>
          <div class="submenu-level2">
            <!-- Декартовый -->
            <div class="submenu-item">
              <div class="submenu-label">Декартовый</div>
              <div class="submenu-level2">
                <button data-action="show_cartesian_params_dialog">Конструктивные параметры</button>
                <button data-action="show_cartesian_limits_dialog">Ограничения по координатам</button>
              </div>
            </div>
            <!-- Цилиндрический -->
            <div class="submenu-item">
              <div class="submenu-label">Цилиндрический</div>
              <div class="submenu-level2">
                <button data-action="show_cylindrical_params_dialog">Конструктивные параметры</button>
                <button data-action="show_cylindrical_limits_dialog">Ограничения по координатам</button>
              </div>
            </div>
            <!-- Скара -->
            <div class="submenu-item">
              <div class="submenu-label">Скара</div>
              <div class="submenu-level2">
                <button data-action="show_scara_params_dialog">Конструктивные параметры</button>
                <button data-action="show_scara_limits_dialog">Ограничения по координатам</button>
              </div>
            </div>
            <!-- Колер -->
            <div class="submenu-item">
              <div class="submenu-label">Колер</div>
              <div class="submenu-level2">
                <button data-action="show_coler_params_dialog">Конструктивные параметры</button>
                <button data-action="show_coler_limits_dialog">Ограничения по координатам</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Система управления -->
        <div class="submenu-item">
          <div class="submenu-label">Система управления</div>
          <div class="submenu-level2">
            <button data-action="show_motor_params_dialog">Параметры двигателей</button>
            <button data-action="show_regulator_params_dialog">Параметры регуляторов</button>
          </div>
        </div>

        <!-- Вычислитель -->
        <button data-action="show_calculator_dialog">Вычислитель</button>

        <!-- Движение -->
        <div class="submenu-item">
          <div class="submenu-label">Движение</div>
          <div class="submenu-level2">
            <button data-action="show_cyclegram_dialog">Позиционное</button>
            <button data-action="show_trajectory_type_dialog">Контурное</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Меню "Расчет" -->
    <div class="menu-root menu-item">
      <div class="menu-label"> Расчет </div>
      <div class="submenu">
        <button data-action="show_graph_settings_dialog">График</button>
        <button data-action="draw_workspace">Рабочая область</button>
      </div>
    </div>

    <div class="menu-spacer"></div>
  </div>

  <!-- ===== Основное окно ===== -->
  <div id="mainWrapper">
    <div id="centralArea">
      <!-- Левый док: время, погода -->
      <aside id="leftDock">
        <!-- DateTimeWidget -->
        <div id="datetimeWidget">
          <div id="datetimeLabel">--:--\n--.--.----</div>
        </div>

        <!-- WeatherWidget -->
        <div id="weatherWidget">
          <div id="weatherInfo">
            Город: --<br>
            Температура: --°C<br>
            Погода: --
          </div>
          <div id="weatherIconBox">
            <img id="weatherIcon" alt="Погода">
          </div>
        </div>
      </aside>

      <!-- Центральные вкладки -->
      <main id="centerContent">
        <div id="tabs" role="tablist" aria-label="Вкладки">
          <div class="tab" role="tab" aria-selected="true" data-target="tabTrajectory">Траектория</div>
          <div class="tab" role="tab" aria-selected="false" data-target="tabWorkspace">Рабочая область</div>
          <div class="tab" role="tab" aria-selected="false" data-target="tabLog">Лог</div>
        </div>
        <div id="tabContent">
          <section id="tabTrajectory" data-active="true">
            <h3>Траектория</h3>
            <p>Здесь будут графики траекторий (matplotlib) и таблица данных.</p>
          </section>
          <section id="tabWorkspace">
            <h3>Рабочая область</h3>
            <p>Здесь будет отображаться рабочая область / декартова плоскость.</p>
          </section>
          <section id="tabLog">
            <h3>Лог</h3>
            <p>Здесь можно вывести текстовый лог расчётов.</p>
          </section>
        </div>
      </main>
    </div>

    <!-- Статусбар -->
    <footer id="statusBar">
      <div id="statusLeft">Готово</div>
      <div id="statusRight">Статус подключения: локально</div>
    </footer>
  </div>


 <!-- ===== Диалог "Тип робота" ===== -->
  <dialog id="robotTypeDialog">
    <div class="dlg">
      <div class="dlg-header">Тип робота</div>
      <div class="dlg-group">
        <div class="dlg-radio">
          <label><input type="radio" name="robotType" value="cartesian" checked> Декартовый</label>
        </div>
        <div class="dlg-radio">
          <label><input type="radio" name="robotType" value="cylindrical"> Цилиндрический</label>
        </div>
        <div class="dlg-radio">
          <label><input type="radio" name="robotType" value="scara"> Скара</label>
        </div>
        <div class="dlg-radio">
          <label><input type="radio" name="robotType" value="coler"> Колер</label>
        </div>
      </div>
      <div class="dlg-footer">
        <button type="button" class="dlg-btn dlg-btn-help" id="robotTypeHelpBtn">Помощь</button>
        <button type="button" class="dlg-btn dlg-btn-ok" id="robotTypeOkBtn">OK</button>
      </div>
    </div>
  </dialog>

  <!-- ===== Диалог "Тип движения" ===== -->
  <dialog id="movementTypeDialog">
    <div class="dlg">
      <div class="dlg-header">Тип движения</div>
      <div class="dlg-group">
        <div class="dlg-radio">
          <label><input type="radio" name="movementType" value="position" checked> Позиционное</label>
        </div>
        <div class="dlg-radio">
          <label><input type="radio" name="movementType" value="contour"> Контурное</label>
        </div>
      </div>
      <div class="dlg-footer">
        <button type="button" class="dlg-btn dlg-btn-help" id="movementTypeHelpBtn">Помощь</button>
        <button type="button" class="dlg-btn dlg-btn-ok" id="movementTypeOkBtn">OK</button>
      </div>
    </div>
  </dialog>

<!-- ===== Конструктивные параметры Декартового робота ===== -->
  <dialog id="robotParamsDialog">
    <div class="dlg">
      <div class="dlg-header" id="robotParamsTitle">
        Конструктивные параметры Декартового робота
      </div>

      <div class="dlg-form">
        <div class="dlg-form-row">
          <label for="mass1">Масса 1-го звена</label>
          <input id="mass1" type="number" step="0.001">
        </div>
        <div class="dlg-form-row">
          <label for="mass3">Масса 3-го звена</label>
          <input id="mass3" type="number" step="0.001">
        </div>
        <div class="dlg-form-row">
          <label for="mass2">Масса 2-го звена</label>
          <input id="mass2" type="number" step="0.001">
        </div>
        <div class="dlg-form-row">
          <label for="moment">Момент инерции</label>
          <input id="moment" type="number" step="0.001">
        </div>
      </div>

      <div class="dlg-footer">
        <div class="dlg-footer-row">
          <button type="button" class="dlg-btn dlg-btn-ok" id="robotParamsOkBtn">ОК</button>
          <button type="button" class="dlg-btn dlg-btn-help" id="robotParamsHelpBtn">Помощь</button>
          <button type="button" class="dlg-btn dlg-btn-cancel" id="robotParamsCancelBtn">Отменить</button>
        </div>
      </div>
    </div>
  </dialog>

  <!-- ===== Ограничения по координатам Декартового робота ===== -->
  <dialog id="robotLimitsDialog">
    <div class="dlg">
      <div class="dlg-header" id="robotLimitsTitle">
        Ограничения по координатам
      </div>

      <div class="dlg-form">
        <div class="dlg-form-row">
          <label for="limXmin">X Мин:</label>
          <input id="limXmin" type="number" step="0.001">
        </div>
        <div class="dlg-form-row">
          <label for="limXmax">X Макс:</label>
          <input id="limXmax" type="number" step="0.001">
        </div>

        <div class="dlg-form-row">
          <label for="limYmin">Y Мин:</label>
          <input id="limYmin" type="number" step="0.001">
        </div>
        <div class="dlg-form-row">
          <label for="limYmax">Y Макс:</label>
          <input id="limYmax" type="number" step="0.001">
        </div>

        <div class="dlg-form-row">
          <label for="limZmin">Z Мин:</label>
          <input id="limZmin" type="number" step="0.001">
        </div>
        <div class="dlg-form-row">
          <label for="limZmax">Z Макс:</label>
          <input id="limZmax" type="number" step="0.001">
        </div>

        <div class="dlg-form-row">
          <label for="limQmin">Q Мин:</label>
          <input id="limQmin" type="number" step="0.001">
        </div>
        <div class="dlg-form-row">
          <label for="limQmax">Q Макс:</label>
          <input id="limQmax" type="number" step="0.001">
        </div>
      </div>

      <div class="dlg-footer">
        <div class="dlg-footer-row">
          <button type="button" class="dlg-btn dlg-btn-ok" id="robotLimitsOkBtn">ОК</button>
          <button type="button" class="dlg-btn dlg-btn-help" id="robotLimitsHelpBtn">Помощь</button>
          <button type="button" class="dlg-btn dlg-btn-cancel" id="robotLimitsCancelBtn">Отменить</button>
        </div>
      </div>
    </div>
  </dialog>

    <!-- ===== Конструктивные параметры Скара ===== -->
  <dialog id="scaraParamsDialog">
    <div class="dlg">
      <div class="dlg-header">
        Конструктивные параметры Скара
      </div>

      <div class="dlg-form">
        <div class="dlg-form-row">
          <label for="sc_moment1">Момент 1-го звена</label>
          <input id="sc_moment1" type="number" step="0.001">
        </div>
        <div class="dlg-form-row">
          <label for="sc_moment2">Момент 2-го звена</label>
          <input id="sc_moment2" type="number" step="0.001">
        </div>
        <div class="dlg-form-row">
          <label for="sc_moment3">Момент 3-го звена</label>
          <input id="sc_moment3" type="number" step="0.001">
        </div>
        <div class="dlg-form-row">
          <label for="sc_length1">Длина 1-го звена</label>
          <input id="sc_length1" type="number" step="0.001">
        </div>
        <div class="dlg-form-row">
          <label for="sc_length2">Длина 2-го звена</label>
          <input id="sc_length2" type="number" step="0.001">
        </div>
        <div class="dlg-form-row">
          <label for="sc_distance">Расстояние</label>
          <input id="sc_distance" type="number" step="0.001">
        </div>
        <div class="dlg-form-row">
          <label for="sc_mass2">Масса 2-го звена</label>
          <input id="sc_mass2" type="number" step="0.001">
        </div>
        <div class="dlg-form-row">
          <label for="sc_mass3">Масса 3-го звена</label>
          <input id="sc_mass3" type="number" step="0.001">
        </div>
      </div>

      <div class="dlg-footer">
        <div class="dlg-footer-row">
          <button type="button" class="dlg-btn dlg-btn-ok" id="scaraParamsOkBtn">ОК</button>
          <button type="button" class="dlg-btn dlg-btn-help" id="scaraParamsHelpBtn">Помощь</button>
          <button type="button" class="dlg-btn dlg-btn-cancel" id="scaraParamsCancelBtn">Отменить</button>
        </div>
      </div>
    </div>
  </dialog>

  <!-- ===== Ограничения по координатам Скара ===== -->
  <dialog id="scaraLimitsDialog">
    <div class="dlg">
      <div class="dlg-header">
        Ограничения по координатам Скара
      </div>

      <div class="dlg-form">
        <div class="dlg-form-row">
          <label for="sc_q1min">Q1min</label>
          <input id="sc_q1min" type="number" step="0.001">
        </div>
        <div class="dlg-form-row">
          <label for="sc_q1max">Q1max</label>
          <input id="sc_q1max" type="number" step="0.001">
        </div>

        <div class="dlg-form-row">
          <label for="sc_q2min">Q2min</label>
          <input id="sc_q2min" type="number" step="0.001">
        </div>
        <div class="dlg-form-row">
          <label for="sc_q2max">Q2max</label>
          <input id="sc_q2max" type="number" step="0.001">
        </div>

        <div class="dlg-form-row">
          <label for="sc_q3min">Q3min</label>
          <input id="sc_q3min" type="number" step="0.001">
        </div>
        <div class="dlg-form-row">
          <label for="sc_q3max">Q3max</label>
          <input id="sc_q3max" type="number" step="0.001">
        </div>

        <div class="dlg-form-row">
          <label for="sc_zmin">Zmin</label>
          <input id="sc_zmin" type="number" step="0.001">
        </div>
        <div class="dlg-form-row">
          <label for="sc_zmax">Zmax</label>
          <input id="sc_zmax" type="number" step="0.001">
        </div>
      </div>

      <div class="dlg-footer">
        <div class="dlg-footer-row">
          <button type="button" class="dlg-btn dlg-btn-ok" id="scaraLimitsOkBtn">ОК</button>
          <button type="button" class="dlg-btn dlg-btn-help" id="scaraLimitsHelpBtn">Помощь</button>
          <button type="button" class="dlg-btn dlg-btn-cancel" id="scaraLimitsCancelBtn">Отменить</button>
        </div>
      </div>
    </div>
  </dialog>

  <!-- ===== Конструктивные параметры Цилиндр ===== -->
  <dialog id="cylParamsDialog">
    <div class="dlg">
      <div class="dlg-header">
        Конструктивные параметры Цилиндр
      </div>

      <div class="dlg-form">
        <div class="dlg-form-row">
          <label for="cyl_moment1">Момент 1-го звена</label>
          <input id="cyl_moment1" type="number" step="0.001">
        </div>
        <div class="dlg-form-row">
          <label for="cyl_moment2">Момент 2-го звена</label>
          <input id="cyl_moment2" type="number" step="0.001">
        </div>
        <div class="dlg-form-row">
          <label for="cyl_moment3">Момент 3-го звена</label>
          <input id="cyl_moment3" type="number" step="0.001">
        </div>
        <div class="dlg-form-row">
          <label for="cyl_length1">Длина 1-го звена</label>
          <input id="cyl_length1" type="number" step="0.001">
        </div>
        <div class="dlg-form-row">
          <label for="cyl_length2">Длина 2-го звена</label>
          <input id="cyl_length2" type="number" step="0.001">
        </div>
        <div class="dlg-form-row">
          <label for="cyl_distance">Расстояние</label>
          <input id="cyl_distance" type="number" step="0.001">
        </div>
        <div class="dlg-form-row">
          <label for="cyl_mass2">Масса 2-го звена</label>
          <input id="cyl_mass2" type="number" step="0.001">
        </div>
        <div class="dlg-form-row">
          <label for="cyl_mass3">Масса 3-го звена</label>
          <input id="cyl_mass3" type="number" step="0.001">
        </div>
      </div>

      <div class="dlg-footer">
        <div class="dlg-footer-row">
          <button type="button" class="dlg-btn dlg-btn-ok" id="cylParamsOkBtn">ОК</button>
          <button type="button" class="dlg-btn dlg-btn-help" id="cylParamsHelpBtn">Помощь</button>
          <button type="button" class="dlg-btn dlg-btn-cancel" id="cylParamsCancelBtn">Отменить</button>
        </div>
      </div>
    </div>
  </dialog>

  <!-- ===== Ограничения по координатам Цилиндр ===== -->
  <dialog id="cylLimitsDialog">
    <div class="dlg">
      <div class="dlg-header">
        Ограничения по координатам Цилиндр
      </div>

      <div class="dlg-form">
        <div class="dlg-form-row">
          <label for="cyl_q1min">Q1min</label>
          <input id="cyl_q1min" type="number" step="0.001">
        </div>
        <div class="dlg-form-row">
          <label for="cyl_q1max">Q1max</label>
          <input id="cyl_q1max" type="number" step="0.001">
        </div>

        <div class="dlg-form-row">
          <label for="cyl_a2min">A2min</label>
          <input id="cyl_a2min" type="number" step="0.001">
        </div>
        <div class="dlg-form-row">
          <label for="cyl_a2max">A2max</label>
          <input id="cyl_a2max" type="number" step="0.001">
        </div>

        <div class="dlg-form-row">
          <label for="cyl_q3min">Q3min</label>
          <input id="cyl_q3min" type="number" step="0.001">
        </div>
        <div class="dlg-form-row">
          <label for="cyl_q3max">Q3max</label>
          <input id="cyl_q3max" type="number" step="0.001">
        </div>

        <div class="dlg-form-row">
          <label for="cyl_zmin">Zmin</label>
          <input id="cyl_zmin" type="number" step="0.001">
        </div>
        <div class="dlg-form-row">
          <label for="cyl_zmax">Zmax</label>
          <input id="cyl_zmax" type="number" step="0.001">
        </div>
      </div>

      <div class="dlg-footer">
        <div class="dlg-footer-row">
          <button type="button" class="dlg-btn dlg-btn-ok" id="cylLimitsOkBtn">ОК</button>
          <button type="button" class="dlg-btn dlg-btn-help" id="cylLimitsHelpBtn">Помощь</button>
          <button type="button" class="dlg-btn dlg-btn-cancel" id="cylLimitsCancelBtn">Отменить</button>
        </div>
      </div>
    </div>
  </dialog>

  <!-- ===== Конструктивные параметры Колер ===== -->
  <dialog id="colerParamsDialog">
    <div class="dlg">
      <div class="dlg-header">
        Конструктивные параметры Колер
      </div>

      <div class="dlg-form">
        <div class="dlg-form-row">
          <label for="col_moment1">Момент 1-го звена</label>
          <input id="col_moment1" type="number" step="0.001">
        </div>
        <div class="dlg-form-row">
          <label for="col_moment2">Момент 2-го звена</label>
          <input id="col_moment2" type="number" step="0.001">
        </div>
        <div class="dlg-form-row">
          <label for="col_moment3">Момент 3-го звена</label>
          <input id="col_moment3" type="number" step="0.001">
        </div>
        <div class="dlg-form-row">
          <label for="col_length1">Длина 1-го звена</label>
          <input id="col_length1" type="number" step="0.001">
        </div>
        <div class="dlg-form-row">
          <label for="col_length2">Длина 2-го звена</label>
          <input id="col_length2" type="number" step="0.001">
        </div>
        <div class="dlg-form-row">
          <label for="col_distance">Расстояние</label>
          <input id="col_distance" type="number" step="0.001">
        </div>
        <div class="dlg-form-row">
          <label for="col_mass2">Масса 2-го звена</label>
          <input id="col_mass2" type="number" step="0.001">
        </div>
        <div class="dlg-form-row">
          <label for="col_mass3">Масса 3-го звена</label>
          <input id="col_mass3" type="number" step="0.001">
        </div>
      </div>

      <div class="dlg-footer">
        <div class="dlg-footer-row">
          <button type="button" class="dlg-btn dlg-btn-ok" id="colerParamsOkBtn">ОК</button>
          <button type="button" class="dlg-btn dlg-btn-help" id="colerParamsHelpBtn">Помощь</button>
          <button type="button" class="dlg-btn dlg-btn-cancel" id="colerParamsCancelBtn">Отменить</button>
        </div>
      </div>
    </div>
  </dialog>

  <!-- ===== Ограничения по координатам Колер ===== -->
  <dialog id="colerLimitsDialog">
    <div class="dlg">
      <div class="dlg-header">
        Ограничения по координатам Колер
      </div>

      <div class="dlg-form">
        <div class="dlg-form-row">
          <label for="col_a2min">A1min</label>
          <input id="col_a2min" type="number" step="0.001">
        </div>
        <div class="dlg-form-row">
          <label for="col_a2max">A2max</label>
          <input id="col_a2max" type="number" step="0.001">
        </div>

        <div class="dlg-form-row">
          <label for="col_q1min">Q1min</label>
          <input id="col_q1min" type="number" step="0.001">
        </div>
        <div class="dlg-form-row">
          <label for="col_q1max">Q1max</label>
          <input id="col_q1max" type="number" step="0.001">
        </div>

        <div class="dlg-form-row">
          <label for="col_q3min">Q3min</label>
          <input id="col_q3min" type="number" step="0.001">
        </div>
        <div class="dlg-form-row">
          <label for="col_q3max">Q3max</label>
          <input id="col_q3max" type="number" step="0.001">
        </div>

        <div class="dlg-form-row">
          <label for="col_zmin">Zmin</label>
          <input id="col_zmin" type="number" step="0.001">
        </div>
        <div class="dlg-form-row">
          <label for="col_zmax">Zmax</label>
          <input id="col_zmax" type="number" step="0.001">
        </div>
      </div>

      <div class="dlg-footer">
        <div class="dlg-footer-row">
          <button type="button" class="dlg-btn dlg-btn-ok" id="colerLimitsOkBtn">ОК</button>
          <button type="button" class="dlg-btn dlg-btn-help" id="colerLimitsHelpBtn">Помощь</button>
          <button type="button" class="dlg-btn dlg-btn-cancel" id="colerLimitsCancelBtn">Отменить</button>
        </div>
      </div>
    </div>
  </dialog>

  <!-- ===== Параметры двигателей ===== -->
  <dialog id="motorParamsDialog" class="dlg-wide">
    <div class="dlg">
      <div class="dlg-header">
        Параметры двигателей
      </div>

      <div class="dlg-form">
        <table style="width:100%; border-collapse:collapse; font-size:13px;">
          <tr>
            <td>J1</td>
            <td><input id="motor_J1" type="number" step="0.001"></td>
            <td>J2</td>
            <td><input id="motor_J2" type="number" step="0.001"></td>
          </tr>
          <tr>
            <td>T_e1</td>
            <td><input id="motor_Te1" type="number" step="0.001"></td>
            <td>T_e2</td>
            <td><input id="motor_Te2" type="number" step="0.001"></td>
          </tr>
          <tr>
            <td>Umax1</td>
            <td><input id="motor_Umax1" type="number" step="0.001"></td>
            <td>Umax2</td>
            <td><input id="motor_Umax2" type="number" step="0.001"></td>
          </tr>
          <tr>
            <td>Fi1</td>
            <td><input id="motor_Fi1" type="number" step="0.001"></td>
            <td>Fi2</td>
            <td><input id="motor_Fi2" type="number" step="0.001"></td>
          </tr>
          <tr>
            <td>Ce1</td>
            <td><input id="motor_Ce1" type="number" step="0.001"></td>
            <td>Ce2</td>
            <td><input id="motor_Ce2" type="number" step="0.001"></td>
          </tr>
          <tr>
            <td>Ra1</td>
            <td><input id="motor_Ra1" type="number" step="0.001"></td>
            <td>Ra2</td>
            <td><input id="motor_Ra2" type="number" step="0.001"></td>
          </tr>
          <tr>
            <td>Cm1</td>
            <td><input id="motor_Cm1" type="number" step="0.001"></td>
            <td>Cm2</td>
            <td><input id="motor_Cm2" type="number" step="0.001"></td>
          </tr>
        </table>
      </div>

      <div class="dlg-footer">
        <div class="dlg-footer-row">
          <button type="button" class="dlg-btn dlg-btn-ok" id="motorParamsOkBtn">ОК</button>
          <button type="button" class="dlg-btn dlg-btn-help" id="motorParamsHelpBtn">Помощь</button>
          <button type="button" class="dlg-btn dlg-btn-cancel" id="motorParamsCancelBtn">Отменить</button>
        </div>
      </div>
    </div>
  </dialog>

    <!-- ===== Параметры регуляторов ===== -->
  <dialog id="regulatorParamsDialog" class="dlg-wide dlg-wide-big">
    <div class="dlg">
      <div class="dlg-header">
        Параметры регуляторов
      </div>

      <div class="dlg-form">
        <table style="width:100%; border-collapse:collapse; font-size:13px;">
          <tr>
            <td>Kп1</td><td><input id="reg_Kp1" type="number" step="0.001"></td>
            <td>Kп2</td><td><input id="reg_Kp2" type="number" step="0.001"></td>
            <td>Kп3</td><td><input id="reg_Kp3" type="number" step="0.001"></td>
            <td>Kп4</td><td><input id="reg_Kp4" type="number" step="0.001"></td>
          </tr>
          <tr>
            <td>Kи1</td><td><input id="reg_Ki1" type="number" step="0.001"></td>
            <td>Kи2</td><td><input id="reg_Ki2" type="number" step="0.001"></td>
            <td>Kи3</td><td><input id="reg_Ki3" type="number" step="0.001"></td>
            <td>Kи4</td><td><input id="reg_Ki4" type="number" step="0.001"></td>
          </tr>
          <tr>
            <td>Kд1</td><td><input id="reg_Kd1" type="number" step="0.001"></td>
            <td>Kд2</td><td><input id="reg_Kd2" type="number" step="0.001"></td>
            <td>Kд3</td><td><input id="reg_Kd3" type="number" step="0.001"></td>
            <td>Kд4</td><td><input id="reg_Kd4" type="number" step="0.001"></td>
          </tr>
        </table>
      </div>

      <div class="dlg-footer">
        <div class="dlg-footer-row">
          <button type="button" class="dlg-btn dlg-btn-ok" id="regParamsOkBtn">ОК</button>
          <button type="button" class="dlg-btn dlg-btn-help" id="regParamsHelpBtn">Помощь</button>
          <button type="button" class="dlg-btn dlg-btn-cancel" id="regParamsCancelBtn">Отменить</button>
        </div>
      </div>
    </div>
  </dialog>


<script>
  // ===== Глобальное состояние =====
  const state = {
    robotType: "cartesian",   // Декартовый / scara / ...
    movementType: "position", // Позиционное / контурное

    // Декартовый
    cartesianParams: {
      mass1: null,
      mass2: null,
      mass3: null,
      moment: null,
    },
    cartesianLimits: {
      Xmin: null, Xmax: null,
      Ymin: null, Ymax: null,
      Zmin: null, Zmax: null,
      Qmin: null, Qmax: null,
    },

    // Скара – конструктивные параметры
    scaraParams: {
      moment1: null,
      moment2: null,
      moment3: null,
      length1: null,
      length2: null,
      distance: null,
      mass2: null,
      mass3: null,
    },

    // Скара – ограничения
    scaraLimits: {
      q1Min: null, q1Max: null,
      q2Min: null, q2Max: null,
      q3Min: null, q3Max: null,
      zMin:  null, zMax:  null,
    },
 // Цилиндр – конструктивные параметры
    cylindricalParams: {
      moment1: null,
      moment2: null,
      moment3: null,
      length1: null,
      length2: null,
      distance: null,
      mass2: null,
      mass3: null,
    },

    // Цилиндр – ограничения
    cylindricalLimits: {
      q1Min: null, q1Max: null,
      a2Min: null, a2Max: null,
      q3Min: null, q3Max: null,
      zMin:  null, zMax:  null,
    },
        // Колер – конструктивные параметры
    colerParams: {
      moment1: null,
      moment2: null,
      moment3: null,
      length1: null,
      length2: null,
      distance: null,
      mass2: null,
      mass3: null,
    },

    // Колер – ограничения
    colerLimits: {
      a2Min: null, a2Max: null,
      q1Min: null, q1Max: null,
      q3Min: null, q3Max: null,
      zMin:  null, zMax:  null,
    },
        // Параметры двигателей (для 2 двигателей)
    motorParams: {
      J:    [null, null],
      Te:   [null, null],   // T_e1, T_e2
      Umax: [null, null],
      Fi:   [null, null],
      Ce:   [null, null],
      Ra:   [null, null],
      Cm:   [null, null],
    },

    // Параметры регуляторов (4 контура)
    regulatorParams: {
      Kp: [null, null, null, null],
      Ki: [null, null, null, null],
      Kd: [null, null, null, null],
    },

  };

  // ===== Время =====
  function updateDateTime() {
    const now = new Date();
    const pad = n => String(n).padStart(2, "0");
    const timeStr = pad(now.getHours()) + ":" + pad(now.getMinutes());
    const dateStr = pad(now.getDate()) + "." + pad(now.getMonth() + 1) + "." + now.getFullYear();
    document.getElementById("datetimeLabel").textContent = timeStr + "\n" + dateStr;
  }
  updateDateTime();
  setInterval(updateDateTime, 1000);

  // ===== Погода =====
  async function loadWeather() {
    try {
      const r = await fetch("/api/weather");
      const data = await r.json();

      document.getElementById("weatherInfo").innerHTML =
        "Город: " + (data.city || "--") + "<br>" +
        "Температура: " +
          (data.temp_c !== null && data.temp_c !== undefined
            ? data.temp_c.toFixed(1) + "°C"
            : "--") + "<br>" +
        "Погода: " + (data.description || "--");

      const iconEl = document.getElementById("weatherIcon");
      if (data.icon_url) {
        iconEl.src = data.icon_url;
        iconEl.style.display = "";
      } else {
        iconEl.style.display = "none";
      }
    } catch (e) {
      console.error("Weather error:", e);
      document.getElementById("statusLeft").textContent = "Ошибка погоды: " + e;
    }
  }
  loadWeather();
  setInterval(loadWeather, 30 * 60 * 1000);

  // ===== Вкладки =====
  const tabs = document.querySelectorAll("#tabs .tab");
  const panels = document.querySelectorAll("#tabContent > section");
  document.getElementById("tabs").addEventListener("click", (e) => {
    const tab = e.target.closest(".tab");
    if (!tab) return;
    tabs.forEach(t => t.setAttribute("aria-selected", String(t === tab)));
    panels.forEach(p => p.dataset.active = (p.id === tab.dataset.target));
  });

  // ===== Диалог "Тип робота" =====
  const robotDlg = document.getElementById("robotTypeDialog");
  const robotOkBtn = document.getElementById("robotTypeOkBtn");
  const robotHelpBtn = document.getElementById("robotTypeHelpBtn");

  function openRobotTypeDialog() {
    const radios = document.querySelectorAll('input[name="robotType"]');
    radios.forEach(r => { r.checked = (r.value === state.robotType); });
    robotDlg.showModal();
  }

  robotOkBtn.addEventListener("click", () => {
    const sel = document.querySelector('input[name="robotType"]:checked');
    if (sel) state.robotType = sel.value;
    robotDlg.close();
    updateStatus();
  });

  robotHelpBtn.addEventListener("click", () => {
    alert("Выберите тип робота: Декартовый, Цилиндрический, Скара или Колер.");
  });

  // ===== Диалог "Тип движения" =====
  const moveDlg = document.getElementById("movementTypeDialog");
  const moveOkBtn = document.getElementById("movementTypeOkBtn");
  const moveHelpBtn = document.getElementById("movementTypeHelpBtn");

  function openMovementTypeDialog() {
    const radios = document.querySelectorAll('input[name="movementType"]');
    radios.forEach(r => { r.checked = (r.value === state.movementType); });
    moveDlg.showModal();
  }

  moveOkBtn.addEventListener("click", () => {
    const sel = document.querySelector('input[name="movementType"]:checked');
    if (sel) state.movementType = sel.value;
    moveDlg.close();
    updateStatus();
  });

  moveHelpBtn.addEventListener("click", () => {
    alert("Выберите тип движения: позиционное или контурное.");
  });

  function robotTypeLabel() {
    switch (state.robotType) {
      case "cartesian":   return "Декартовый";
      case "cylindrical": return "Цилиндрический";
      case "scara":       return "Скара";
      case "coler":       return "Колер";
      default:            return state.robotType;
    }
  }
  function movementTypeLabel() {
    switch (state.movementType) {
      case "position": return "Позиционное";
      case "contour":  return "Контурное";
      default:         return state.movementType;
    }
  }

  // ===== Общая проверка чисел =====
  function parseField(input) {
    const v = parseFloat(String(input.value).replace(",", "."));
    if (Number.isNaN(v)) {
      input.style.borderColor = "red";
      return null;
    }
    input.style.borderColor = "#d4d4d4";
    return v;
  }

  // ===== Декартовый: конструктивные параметры =====
  const robotParamsDlg = document.getElementById("robotParamsDialog");
  const robotParamsOkBtn = document.getElementById("robotParamsOkBtn");
  const robotParamsHelpBtn = document.getElementById("robotParamsHelpBtn");
  const robotParamsCancelBtn = document.getElementById("robotParamsCancelBtn");

  const mass1Input = document.getElementById("mass1");
  const mass2Input = document.getElementById("mass2");
  const mass3Input = document.getElementById("mass3");
  const momentInput = document.getElementById("moment");

  function openCartesianParamsDialog() {
    const p = state.cartesianParams;
    mass1Input.value = p.mass1 ?? "";
    mass2Input.value = p.mass2 ?? "";
    mass3Input.value = p.mass3 ?? "";
    momentInput.value = p.moment ?? "";
    robotParamsDlg.showModal();
  }

  robotParamsOkBtn.addEventListener("click", () => {
    const m1 = parseField(mass1Input);
    const m2 = parseField(mass2Input);
    const m3 = parseField(mass3Input);
    const mo = parseField(momentInput);

    if ([m1, m2, m3, mo].some(v => v === null)) {
      alert("Некорректные значения масс/момента инерции.");
      return;
    }

    state.cartesianParams = { mass1: m1, mass2: m2, mass3: m3, moment: mo };
    robotParamsDlg.close();
    updateStatus();
  });

  robotParamsCancelBtn.addEventListener("click", () => robotParamsDlg.close());
  robotParamsHelpBtn.addEventListener("click", () => {
    alert("Конструктивные параметры Декартового робота: массы 1-3 звеньев и момент инерции.");
  });

  // ===== Декартовый: ограничения =====
  const robotLimitsDlg = document.getElementById("robotLimitsDialog");
  const robotLimitsOkBtn = document.getElementById("robotLimitsOkBtn");
  const robotLimitsHelpBtn = document.getElementById("robotLimitsHelpBtn");
  const robotLimitsCancelBtn = document.getElementById("robotLimitsCancelBtn");

  const limXmin = document.getElementById("limXmin");
  const limXmax = document.getElementById("limXmax");
  const limYmin = document.getElementById("limYmin");
  const limYmax = document.getElementById("limYmax");
  const limZmin = document.getElementById("limZmin");
  const limZmax = document.getElementById("limZmax");
  const limQmin = document.getElementById("limQmin");
  const limQmax = document.getElementById("limQmax");

  function openCartesianLimitsDialog() {
    const l = state.cartesianLimits;
    limXmin.value = l.Xmin ?? "";
    limXmax.value = l.Xmax ?? "";
    limYmin.value = l.Ymin ?? "";
    limYmax.value = l.Ymax ?? "";
    limZmin.value = l.Zmin ?? "";
    limZmax.value = l.Zmax ?? "";
    limQmin.value = l.Qmin ?? "";
    limQmax.value = l.Qmax ?? "";
    robotLimitsDlg.showModal();
  }

  robotLimitsOkBtn.addEventListener("click", () => {
    const Xmin = parseField(limXmin);
    const Xmax = parseField(limXmax);
    const Ymin = parseField(limYmin);
    const Ymax = parseField(limYmax);
    const Zmin = parseField(limZmin);
    const Zmax = parseField(limZmax);
    const Qmin = parseField(limQmin);
    const Qmax = parseField(limQmax);

    if ([Xmin,Xmax,Ymin,Ymax,Zmin,Zmax,Qmin,Qmax].some(v => v === null)) {
      alert("Некорректные ограничения по координатам.");
      return;
    }

    state.cartesianLimits = { Xmin, Xmax, Ymin, Ymax, Zmin, Zmax, Qmin, Qmax };
    robotLimitsDlg.close();
    updateStatus();
  });

  robotLimitsCancelBtn.addEventListener("click", () => robotLimitsDlg.close());
  robotLimitsHelpBtn.addEventListener("click", () => {
    alert("Ограничения по координатам для декартового робота (X, Y, Z, Q).");
  });

  // ===== Скара: конструктивные параметры =====
  const scaraParamsDlg = document.getElementById("scaraParamsDialog");
  const scaraParamsOkBtn = document.getElementById("scaraParamsOkBtn");
  const scaraParamsHelpBtn = document.getElementById("scaraParamsHelpBtn");
  const scaraParamsCancelBtn = document.getElementById("scaraParamsCancelBtn");

  const sc_moment1 = document.getElementById("sc_moment1");
  const sc_moment2 = document.getElementById("sc_moment2");
  const sc_moment3 = document.getElementById("sc_moment3");
  const sc_length1 = document.getElementById("sc_length1");
  const sc_length2 = document.getElementById("sc_length2");
  const sc_distance = document.getElementById("sc_distance");
  const sc_mass2 = document.getElementById("sc_mass2");
  const sc_mass3 = document.getElementById("sc_mass3");

  function openScaraParamsDialog() {
    const p = state.scaraParams;
    sc_moment1.value = p.moment1 ?? "";
    sc_moment2.value = p.moment2 ?? "";
    sc_moment3.value = p.moment3 ?? "";
    sc_length1.value = p.length1 ?? "";
    sc_length2.value = p.length2 ?? "";
    sc_distance.value = p.distance ?? "";
    sc_mass2.value = p.mass2 ?? "";
    sc_mass3.value = p.mass3 ?? "";
    scaraParamsDlg.showModal();
  }

  scaraParamsOkBtn.addEventListener("click", () => {
    const moment1 = parseField(sc_moment1);
    const moment2 = parseField(sc_moment2);
    const moment3 = parseField(sc_moment3);
    const length1 = parseField(sc_length1);
    const length2 = parseField(sc_length2);
    const distance = parseField(sc_distance);
    const mass2   = parseField(sc_mass2);
    const mass3   = parseField(sc_mass3);

    if ([moment1,moment2,moment3,length1,length2,distance,mass2,mass3].some(v => v === null)) {
      alert("Некорректные конструктивные параметры Скара.");
      return;
    }

    state.scaraParams = { moment1, moment2, moment3, length1, length2, distance, mass2, mass3 };
    scaraParamsDlg.close();
    updateStatus();
  });

  scaraParamsCancelBtn.addEventListener("click", () => scaraParamsDlg.close());
  scaraParamsHelpBtn.addEventListener("click", () => {
    alert("Параметры СКАРА: моменты 1-3 звеньев, длины звеньев, расстояние, массы 2-3 звеньев.\nЭто веб-аналог show_scara_params_dialog.");
  });

  // ===== Скара: ограничения =====
  const scaraLimitsDlg = document.getElementById("scaraLimitsDialog");
  const scaraLimitsOkBtn = document.getElementById("scaraLimitsOkBtn");
  const scaraLimitsHelpBtn = document.getElementById("scaraLimitsHelpBtn");
  const scaraLimitsCancelBtn = document.getElementById("scaraLimitsCancelBtn");

  const sc_q1min = document.getElementById("sc_q1min");
  const sc_q1max = document.getElementById("sc_q1max");
  const sc_q2min = document.getElementById("sc_q2min");
  const sc_q2max = document.getElementById("sc_q2max");
  const sc_q3min = document.getElementById("sc_q3min");
  const sc_q3max = document.getElementById("sc_q3max");
  const sc_zmin  = document.getElementById("sc_zmin");
  const sc_zmax  = document.getElementById("sc_zmax");

  function openScaraLimitsDialog() {
    const l = state.scaraLimits;
    sc_q1min.value = l.q1Min ?? "";
    sc_q1max.value = l.q1Max ?? "";
    sc_q2min.value = l.q2Min ?? "";
    sc_q2max.value = l.q2Max ?? "";
    sc_q3min.value = l.q3Min ?? "";
    sc_q3max.value = l.q3Max ?? "";
    sc_zmin.value  = l.zMin  ?? "";
    sc_zmax.value  = l.zMax  ?? "";
    scaraLimitsDlg.showModal();
  }

  scaraLimitsOkBtn.addEventListener("click", () => {
    const q1Min = parseField(sc_q1min);
    const q1Max = parseField(sc_q1max);
    const q2Min = parseField(sc_q2min);
    const q2Max = parseField(sc_q2max);
    const q3Min = parseField(sc_q3min);
    const q3Max = parseField(sc_q3max);
    const zMin  = parseField(sc_zmin);
    const zMax  = parseField(sc_zmax);

    if ([q1Min,q1Max,q2Min,q2Max,q3Min,q3Max,zMin,zMax].some(v => v === null)) {
      alert("Некорректные ограничения для Скара.");
      return;
    }

    state.scaraLimits = { q1Min,q1Max,q2Min,q2Max,q3Min,q3Max,zMin,zMax };
    scaraLimitsDlg.close();
    updateStatus();
  });

  scaraLimitsCancelBtn.addEventListener("click", () => scaraLimitsDlg.close());
  scaraLimitsHelpBtn.addEventListener("click", () => {
    alert("Ограничения по обобщённым координатам СКАРА (Q1–Q3, Z).\nАналог show_scara_limits_dialog.");
  });

    // ===== Цилиндр: конструктивные параметры =====
  const cylParamsDlg = document.getElementById("cylParamsDialog");
  const cylParamsOkBtn = document.getElementById("cylParamsOkBtn");
  const cylParamsHelpBtn = document.getElementById("cylParamsHelpBtn");
  const cylParamsCancelBtn = document.getElementById("cylParamsCancelBtn");

  const cyl_moment1 = document.getElementById("cyl_moment1");
  const cyl_moment2 = document.getElementById("cyl_moment2");
  const cyl_moment3 = document.getElementById("cyl_moment3");
  const cyl_length1 = document.getElementById("cyl_length1");
  const cyl_length2 = document.getElementById("cyl_length2");
  const cyl_distance = document.getElementById("cyl_distance");
  const cyl_mass2   = document.getElementById("cyl_mass2");
  const cyl_mass3   = document.getElementById("cyl_mass3");

  function openCylindricalParamsDialog() {
    const p = state.cylindricalParams;
    cyl_moment1.value = p.moment1 ?? "";
    cyl_moment2.value = p.moment2 ?? "";
    cyl_moment3.value = p.moment3 ?? "";
    cyl_length1.value = p.length1 ?? "";
    cyl_length2.value = p.length2 ?? "";
    cyl_distance.value = p.distance ?? "";
    cyl_mass2.value   = p.mass2 ?? "";
    cyl_mass3.value   = p.mass3 ?? "";
    cylParamsDlg.showModal();
  }

  cylParamsOkBtn.addEventListener("click", () => {
    const moment1 = parseField(cyl_moment1);
    const moment2 = parseField(cyl_moment2);
    const moment3 = parseField(cyl_moment3);
    const length1 = parseField(cyl_length1);
    const length2 = parseField(cyl_length2);
    const distance = parseField(cyl_distance);
    const mass2   = parseField(cyl_mass2);
    const mass3   = parseField(cyl_mass3);

    if ([moment1,moment2,moment3,length1,length2,distance,mass2,mass3].some(v => v === null)) {
      alert("Некорректные конструктивные параметры Цилиндр.");
      return;
    }

    state.cylindricalParams = { moment1,moment2,moment3,length1,length2,distance,mass2,mass3 };
    cylParamsDlg.close();
    updateStatus();
  });

  cylParamsCancelBtn.addEventListener("click", () => cylParamsDlg.close());
  cylParamsHelpBtn.addEventListener("click", () => {
    alert("Конструктивные параметры цилиндрического робота:\n" +
          "моменты 1–3 звеньев, длины 1–2 звеньев, расстояние и массы 2–3 звеньев.\n" +
          "Это веб-аналог show_cylindrical_params_dialog.");
  });

    // ===== Цилиндр: ограничения =====
  const cylLimitsDlg = document.getElementById("cylLimitsDialog");
  const cylLimitsOkBtn = document.getElementById("cylLimitsOkBtn");
  const cylLimitsHelpBtn = document.getElementById("cylLimitsHelpBtn");
  const cylLimitsCancelBtn = document.getElementById("cylLimitsCancelBtn");

  const cyl_q1min = document.getElementById("cyl_q1min");
  const cyl_q1max = document.getElementById("cyl_q1max");
  const cyl_a2min = document.getElementById("cyl_a2min");
  const cyl_a2max = document.getElementById("cyl_a2max");
  const cyl_q3min = document.getElementById("cyl_q3min");
  const cyl_q3max = document.getElementById("cyl_q3max");
  const cyl_zmin  = document.getElementById("cyl_zmin");
  const cyl_zmax  = document.getElementById("cyl_zmax");

  function openCylindricalLimitsDialog() {
    const l = state.cylindricalLimits;
    cyl_q1min.value = l.q1Min ?? "";
    cyl_q1max.value = l.q1Max ?? "";
    cyl_a2min.value = l.a2Min ?? "";
    cyl_a2max.value = l.a2Max ?? "";
    cyl_q3min.value = l.q3Min ?? "";
    cyl_q3max.value = l.q3Max ?? "";
    cyl_zmin.value  = l.zMin  ?? "";
    cyl_zmax.value  = l.zMax  ?? "";
    cylLimitsDlg.showModal();
  }

  cylLimitsOkBtn.addEventListener("click", () => {
    const q1Min = parseField(cyl_q1min);
    const q1Max = parseField(cyl_q1max);
    const a2Min = parseField(cyl_a2min);
    const a2Max = parseField(cyl_a2max);
    const q3Min = parseField(cyl_q3min);
    const q3Max = parseField(cyl_q3max);
    const zMin  = parseField(cyl_zmin);
    const zMax  = parseField(cyl_zmax);

    if ([q1Min,q1Max,a2Min,a2Max,q3Min,q3Max,zMin,zMax].some(v => v === null)) {
      alert("Некорректные ограничения по координатам для Цилиндр.");
      return;
    }

    state.cylindricalLimits = { q1Min,q1Max,a2Min,a2Max,q3Min,q3Max,zMin,zMax };
    cylLimitsDlg.close();
    updateStatus();
  });

  cylLimitsCancelBtn.addEventListener("click", () => cylLimitsDlg.close());
  cylLimitsHelpBtn.addEventListener("click", () => {
    alert("Ограничения по координатам цилиндрического робота:\n" +
          "Q1, A2, Q3 и Z (min/max). Веб-аналог show_cylindrical_limits_dialog.");
  });

    // ===== Колер: конструктивные параметры =====
  const colerParamsDlg       = document.getElementById("colerParamsDialog");
  const colerParamsOkBtn     = document.getElementById("colerParamsOkBtn");
  const colerParamsHelpBtn   = document.getElementById("colerParamsHelpBtn");
  const colerParamsCancelBtn = document.getElementById("colerParamsCancelBtn");

  const col_moment1  = document.getElementById("col_moment1");
  const col_moment2  = document.getElementById("col_moment2");
  const col_moment3  = document.getElementById("col_moment3");
  const col_length1  = document.getElementById("col_length1");
  const col_length2  = document.getElementById("col_length2");
  const col_distance = document.getElementById("col_distance");
  const col_mass2    = document.getElementById("col_mass2");
  const col_mass3    = document.getElementById("col_mass3");

  function openColerParamsDialog() {
    const p = state.colerParams;
    col_moment1.value  = p.moment1  ?? "";
    col_moment2.value  = p.moment2  ?? "";
    col_moment3.value  = p.moment3  ?? "";
    col_length1.value  = p.length1  ?? "";
    col_length2.value  = p.length2  ?? "";
    col_distance.value = p.distance ?? "";
    col_mass2.value    = p.mass2    ?? "";
    col_mass3.value    = p.mass3    ?? "";
    colerParamsDlg.showModal();
  }

  colerParamsOkBtn.addEventListener("click", () => {
    const moment1  = parseField(col_moment1);
    const moment2  = parseField(col_moment2);
    const moment3  = parseField(col_moment3);
    const length1  = parseField(col_length1);
    const length2  = parseField(col_length2);
    const distance = parseField(col_distance);
    const mass2    = parseField(col_mass2);
    const mass3    = parseField(col_mass3);

    if ([moment1,moment2,moment3,length1,length2,distance,mass2,mass3].some(v => v === null)) {
      alert("Некорректные конструктивные параметры Колер.");
      return;
    }

    state.colerParams = { moment1,moment2,moment3,length1,length2,distance,mass2,mass3 };
    colerParamsDlg.close();
    updateStatus();
  });

  colerParamsCancelBtn.addEventListener("click", () => colerParamsDlg.close());

  colerParamsHelpBtn.addEventListener("click", () => {
    alert("Конструктивные параметры робота Колер:\n" +
          "моменты 1–3 звеньев, длины 1–2 звеньев, расстояние и массы 2–3 звеньев.\n" +
          "Это веб-аналог show_coler_params_dialog.");
  });
  // ===== Колер: ограничения =====
  const colerLimitsDlg       = document.getElementById("colerLimitsDialog");
  const colerLimitsOkBtn     = document.getElementById("colerLimitsOkBtn");
  const colerLimitsHelpBtn   = document.getElementById("colerLimitsHelpBtn");
  const colerLimitsCancelBtn = document.getElementById("colerLimitsCancelBtn");

  const col_a2min = document.getElementById("col_a2min");
  const col_a2max = document.getElementById("col_a2max");
  const col_q1min = document.getElementById("col_q1min");
  const col_q1max = document.getElementById("col_q1max");
  const col_q3min = document.getElementById("col_q3min");
  const col_q3max = document.getElementById("col_q3max");
  const col_zmin  = document.getElementById("col_zmin");
  const col_zmax  = document.getElementById("col_zmax");

  function openColerLimitsDialog() {
    const l = state.colerLimits;
    col_a2min.value = l.a2Min ?? "";
    col_a2max.value = l.a2Max ?? "";
    col_q1min.value = l.q1Min ?? "";
    col_q1max.value = l.q1Max ?? "";
    col_q3min.value = l.q3Min ?? "";
    col_q3max.value = l.q3Max ?? "";
    col_zmin.value  = l.zMin  ?? "";
    col_zmax.value  = l.zMax  ?? "";
    colerLimitsDlg.showModal();
  }

  colerLimitsOkBtn.addEventListener("click", () => {
    const a2Min = parseField(col_a2min);
    const a2Max = parseField(col_a2max);
    const q1Min = parseField(col_q1min);
    const q1Max = parseField(col_q1max);
    const q3Min = parseField(col_q3min);
    const q3Max = parseField(col_q3max);
    const zMin  = parseField(col_zmin);
    const zMax  = parseField(col_zmax);

    if ([a2Min,a2Max,q1Min,q1Max,q3Min,q3Max,zMin,zMax].some(v => v === null)) {
      alert("Некорректные ограничения по координатам для Колер.");
      return;
    }

    state.colerLimits = { a2Min,a2Max,q1Min,q1Max,q3Min,q3Max,zMin,zMax };
    colerLimitsDlg.close();
    updateStatus();
  });

  colerLimitsCancelBtn.addEventListener("click", () => colerLimitsDlg.close());

  colerLimitsHelpBtn.addEventListener("click", () => {
    alert("Ограничения по координатам робота Колер:\n" +
          "A1/A2, Q1, Q3 и Z (min/max).\n" +
          "Это веб-аналог show_coler_limits_dialog.");
  });

    // ===== Параметры двигателей =====
  const motorParamsDlg       = document.getElementById("motorParamsDialog");
  const motorParamsOkBtn     = document.getElementById("motorParamsOkBtn");
  const motorParamsHelpBtn   = document.getElementById("motorParamsHelpBtn");
  const motorParamsCancelBtn = document.getElementById("motorParamsCancelBtn");

  const motor_J1   = document.getElementById("motor_J1");
  const motor_J2   = document.getElementById("motor_J2");
  const motor_Te1  = document.getElementById("motor_Te1");
  const motor_Te2  = document.getElementById("motor_Te2");
  const motor_Umax1= document.getElementById("motor_Umax1");
  const motor_Umax2= document.getElementById("motor_Umax2");
  const motor_Fi1  = document.getElementById("motor_Fi1");
  const motor_Fi2  = document.getElementById("motor_Fi2");
  const motor_Ce1  = document.getElementById("motor_Ce1");
  const motor_Ce2  = document.getElementById("motor_Ce2");
  const motor_Ra1  = document.getElementById("motor_Ra1");
  const motor_Ra2  = document.getElementById("motor_Ra2");
  const motor_Cm1  = document.getElementById("motor_Cm1");
  const motor_Cm2  = document.getElementById("motor_Cm2");

  function openMotorParamsDialog() {
    const m = state.motorParams;
    motor_J1.value    = m.J[0]    ?? "";
    motor_J2.value    = m.J[1]    ?? "";
    motor_Te1.value   = m.Te[0]   ?? "";
    motor_Te2.value   = m.Te[1]   ?? "";
    motor_Umax1.value = m.Umax[0] ?? "";
    motor_Umax2.value = m.Umax[1] ?? "";
    motor_Fi1.value   = m.Fi[0]   ?? "";
    motor_Fi2.value   = m.Fi[1]   ?? "";
    motor_Ce1.value   = m.Ce[0]   ?? "";
    motor_Ce2.value   = m.Ce[1]   ?? "";
    motor_Ra1.value   = m.Ra[0]   ?? "";
    motor_Ra2.value   = m.Ra[1]   ?? "";
    motor_Cm1.value   = m.Cm[0]   ?? "";
    motor_Cm2.value   = m.Cm[1]   ?? "";
    motorParamsDlg.showModal();
  }

  motorParamsOkBtn.addEventListener("click", () => {
    const J1    = parseField(motor_J1);
    const J2    = parseField(motor_J2);
    const Te1   = parseField(motor_Te1);
    const Te2   = parseField(motor_Te2);
    const Umax1 = parseField(motor_Umax1);
    const Umax2 = parseField(motor_Umax2);
    const Fi1   = parseField(motor_Fi1);
    const Fi2   = parseField(motor_Fi2);
    const Ce1   = parseField(motor_Ce1);
    const Ce2   = parseField(motor_Ce2);
    const Ra1   = parseField(motor_Ra1);
    const Ra2   = parseField(motor_Ra2);
    const Cm1   = parseField(motor_Cm1);
    const Cm2   = parseField(motor_Cm2);

    if ([J1,J2,Te1,Te2,Umax1,Umax2,Fi1,Fi2,Ce1,Ce2,Ra1,Ra2,Cm1,Cm2].some(v => v === null)) {
      alert("Некорректные параметры двигателей. Проверьте введённые значения.");
      return;
    }

    state.motorParams = {
      J:    [J1, J2],
      Te:   [Te1, Te2],
      Umax: [Umax1, Umax2],
      Fi:   [Fi1, Fi2],
      Ce:   [Ce1, Ce2],
      Ra:   [Ra1, Ra2],
      Cm:   [Cm1, Cm2],
    };

    motorParamsDlg.close();
    updateStatus();
  });

  motorParamsCancelBtn.addEventListener("click", () => motorParamsDlg.close());

  motorParamsHelpBtn.addEventListener("click", () => {
    alert("Параметры двигателей: инерции J1/J2, электромагн. постоянные T_e, " +
          "максимальные напряжения Umax, потоки Fi, коэффициенты Ce, сопротивления Ra, моменты Cm.\n" +
          "Аналог show_motor_params_dialog в PyQt.");
  });

    // ===== Параметры регуляторов =====
  const regParamsDlg       = document.getElementById("regulatorParamsDialog");
  const regParamsOkBtn     = document.getElementById("regParamsOkBtn");
  const regParamsHelpBtn   = document.getElementById("regParamsHelpBtn");
  const regParamsCancelBtn = document.getElementById("regParamsCancelBtn");

  const reg_Kp1 = document.getElementById("reg_Kp1");
  const reg_Kp2 = document.getElementById("reg_Kp2");
  const reg_Kp3 = document.getElementById("reg_Kp3");
  const reg_Kp4 = document.getElementById("reg_Kp4");
  const reg_Ki1 = document.getElementById("reg_Ki1");
  const reg_Ki2 = document.getElementById("reg_Ki2");
  const reg_Ki3 = document.getElementById("reg_Ki3");
  const reg_Ki4 = document.getElementById("reg_Ki4");
  const reg_Kd1 = document.getElementById("reg_Kd1");
  const reg_Kd2 = document.getElementById("reg_Kd2");
  const reg_Kd3 = document.getElementById("reg_Kd3");
  const reg_Kd4 = document.getElementById("reg_Kd4");

  function openRegulatorParamsDialog() {
    const r = state.regulatorParams;
    reg_Kp1.value = r.Kp[0] ?? "";
    reg_Kp2.value = r.Kp[1] ?? "";
    reg_Kp3.value = r.Kp[2] ?? "";
    reg_Kp4.value = r.Kp[3] ?? "";
    reg_Ki1.value = r.Ki[0] ?? "";
    reg_Ki2.value = r.Ki[1] ?? "";
    reg_Ki3.value = r.Ki[2] ?? "";
    reg_Ki4.value = r.Ki[3] ?? "";
    reg_Kd1.value = r.Kd[0] ?? "";
    reg_Kd2.value = r.Kd[1] ?? "";
    reg_Kd3.value = r.Kd[2] ?? "";
    reg_Kd4.value = r.Kd[3] ?? "";
    regParamsDlg.showModal();
  }

  regParamsOkBtn.addEventListener("click", () => {
    const Kp1 = parseField(reg_Kp1);
    const Kp2 = parseField(reg_Kp2);
    const Kp3 = parseField(reg_Kp3);
    const Kp4 = parseField(reg_Kp4);
    const Ki1 = parseField(reg_Ki1);
    const Ki2 = parseField(reg_Ki2);
    const Ki3 = parseField(reg_Ki3);
    const Ki4 = parseField(reg_Ki4);
    const Kd1 = parseField(reg_Kd1);
    const Kd2 = parseField(reg_Kd2);
    const Kd3 = parseField(reg_Kd3);
    const Kd4 = parseField(reg_Kd4);

    if ([Kp1,Kp2,Kp3,Kp4,Ki1,Ki2,Ki3,Ki4,Kd1,Kd2,Kd3,Kd4].some(v => v === null)) {
      alert("Некорректные параметры регуляторов. Проверьте введённые значения.");
      return;
    }

    state.regulatorParams = {
      Kp: [Kp1,Kp2,Kp3,Kp4],
      Ki: [Ki1,Ki2,Ki3,Ki4],
      Kd: [Kd1,Kd2,Kd3,Kd4],
    };

    regParamsDlg.close();
    updateStatus();
  });

  regParamsCancelBtn.addEventListener("click", () => regParamsDlg.close());

  regParamsHelpBtn.addEventListener("click", () => {
    alert("Параметры регуляторов (PID):\n" +
          "Kп1–Kп4, Kи1–Kи4, Kд1–Kд4 для трёх ветвей.\n" +
          "Это веб-аналог show_regulator_params_dialog.");
  });



  // ===== Обновление статусбара =====
  function updateStatus() {
    let extra = "";
    if (state.robotType === "cartesian") {
      const p = state.cartesianParams;
      extra = (p.mass1 != null)
        ? `Декарт: m1=${p.mass1}, m2=${p.mass2}, m3=${p.mass3}, J=${p.moment}`
        : "Декарт: параметры не заданы";
    } else if (state.robotType === "scara") {
      const p = state.scaraParams;
      extra = (p.moment1 != null)
        ? `Скара: M1=${p.moment1}, M2=${p.moment2}, M3=${p.moment3}`
        : "Скара: параметры не заданы";
    } else if (state.robotType === "cylindrical") {
      const p = state.cylindricalParams;
      extra = (p.moment1 != null)
        ? `Цилиндр: M1=${p.moment1}, M2=${p.moment2}, M3=${p.moment3}`
        : "Цилиндр: параметры не заданы";
    } else if (state.robotType === "coler") {
    const p = state.colerParams;
    extra = (p.moment1 != null)
      ? `Колер: M1=${p.moment1}, M2=${p.moment2}, M3=${p.moment3}`
      : "Колер: параметры не заданы";
  }

const mp = state.motorParams;
    const motorsOk = mp.J[0] != null;
    const motorsInfo = motorsOk ? ` | Двигатели: J1=${mp.J[0]}, J2=${mp.J[1]}` : "";

    document.getElementById("statusRight").textContent =
      `Тип робота: ${robotTypeLabel()} | Тип движения: ${movementTypeLabel()} | ${extra}`;
  }
  updateStatus();

  // ===== Обработчики пунктов меню =====
  const actions = {
    show_creators_info()      { alert("show_creators_info() – окно 'Создатели'."); },
    check_for_update()        { alert("check_for_update() – проверка обновлений."); },

    load_data()               { alert("load_data() – диалог 'Загрузить данные'."); },
    save_data()               { alert("save_data() – обычное сохранение."); },
    save_data_as()            { alert("save_data_as() – 'Сохранить как'."); },

    show_robot_type_dialog()  { openRobotTypeDialog(); },
    show_movement_type_dialog(){ openMovementTypeDialog(); },

    // Декартовый
    show_cartesian_params_dialog() { openCartesianParamsDialog(); },
    show_cartesian_limits_dialog() { openCartesianLimitsDialog(); },

    // Скара
    show_scara_params_dialog()    { openScaraParamsDialog(); },
    show_scara_limits_dialog()    { openScaraLimitsDialog(); },

    // Остальные пока-заглушки
    show_cylindrical_params_dialog() { openCylindricalParamsDialog(); },
    show_cylindrical_limits_dialog() { openCylindricalLimitsDialog(); },

    show_coler_params_dialog()       { openColerParamsDialog(); },
    show_coler_limits_dialog()       { openColerLimitsDialog(); },

    show_motor_params_dialog()      { openMotorParamsDialog(); },
    show_regulator_params_dialog()  { openRegulatorParamsDialog(); },


    show_calculator_dialog()     { alert("Вычислитель."); },

    show_cyclegram_dialog()      { alert("Позиционное движение (цикограмма)."); },
    show_trajectory_type_dialog(){ alert("Контурное движение (тип траектории)."); },

    show_graph_settings_dialog() { alert("Настройки графика/расчёт графика."); },
    draw_workspace()             { alert("Расчёт и отрисовка рабочей области."); },
  };

  document.getElementById("menuBar").addEventListener("click", (e) => {
    const btn = e.target.closest("[data-action]");
    if (!btn) return;
    const name = btn.dataset.action;
    if (name && typeof actions[name] === "function") {
      actions[name]();
    }
  });
</script>




</body>
</html>
